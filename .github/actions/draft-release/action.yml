name: "Draft Release"
description: "Create a draft GitHub Release"
inputs:
  token:
    description: "GitHub access token"
    required: true
  target:
    description: "The owner/repo GitHub target"
    required: false
  release_url:
    description: "The full url to the GitHub release page"
    required: false
  dry_run:
    description: "If set, do not push permanent changes"
    default: "false"
    required: false
  steps_to_skip:
    description: "Comma separated list of steps to skip"
    required: false

outputs:
  release_url:
    description: "The html URL of the draft GitHub release"
    value: ${{ steps.draft-release.outputs.release_url }}

runs:
  using: "composite"
  steps:
    - name: install-releaser
      uses: ./.gitub/actions/install-releaser

    - shell: bash
      id: draft-release
      run: |
        set -eux

        # Set up env variables
        export GITHUB_ACCESS_TOKEN=${{ inputs.token }}
        export RH_REPOSITORY=${{ inputs.target }}
        export RH_DRY_RUN=${{ inputs.dry_run }}
        export RH_STEPS_TO_SKIP=${{ inputs.steps_to_skip }}
        export RH_RELEASE_URL=${{ inputs.release_url }}

        # Draft Release
        python -m jupyter_releaser.actions.draft_release
